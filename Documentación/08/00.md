S√≠, en el c√≥digo hay varios sitios claros para limpieza/refactor que encajan muy bien con todo lo que ya hemos definido en los documentos.

1. C√≥digo duplicado / patrones repetidos
~~Patrones de fetch + try/catch + toast + loading se repiten casi id√©nticos en:~~

~~- Gesti√≥n de tipos de documento (handleDelete, fetchTipos‚Ä¶).~~
~~- Gesti√≥n de usuarios (fetchUsuarios, handleResetPassword‚Ä¶).~~
- Ticketing (fetchTickets, acciones de reply/escalar/nota interna‚Ä¶).

~~Esto pide a gritos:~~
~~Un hook gen√©rico tipo useApiAction / useFetchList con:~~
~~- manejo de loading, error, success~~
~~- toasts est√°ndar~~
~~- logging opcional~~
~~**Resultado:** menos l√≠neas por p√°gina y menos bugs sutiles al cambiar algo en un sitio y olvidarlo en otro.~~

~~Renderizado de tablas ‚Äúlistado + acciones‚Äù se repite con el mismo patr√≥n:~~
~~- Tipos de documento, usuarios, tickets, vector results table.~~
~~Ser√≠a buen candidato a:~~
~~- Un componente tabla gen√©rico tipo <EntityTable columns={...} data={...} actions={...} />~~
~~- O al menos un set de componentes reutilizables (Row, Cell, Header) con config.~~

2. Zonas casi muertas / UX ‚Äúa medio hacer‚Äù
En TicketDetail tienes comentarios como:
‚ÄúPara UX instant√°nea, podr√≠amos usar estado local optimista, pero por ahora reload simple‚Ä¶‚Äù

Y luego se hace window.location.reload() tras enviar respuesta / escalar / nota interna.

Eso es c√≥digo ‚Äútemporal‚Äù que ya est√° pidiendo refactor:
- Reemplazar reload() por:
  - invalidaci√≥n de cache (React Query/SWR), o
  - levantar el estado al padre y refrescar la lista.

Adem√°s rompe el patr√≥n SPA y tira por tierra parte del trabajo de UX.

En notificaciones: l√≥gica compleja de destinatarios, preferencias, canales, pero sin integraci√≥n con eventos realtime (solo comentario de ‚Äúse podr√≠a emitir Socket.io aqu√≠‚Äù).

Es funcional, pero esa zona est√° ‚Äúmedio paso‚Äù entre dise√±o ideal y estado actual.

3. C√≥digo que podr√≠a simplificarse
Ticket badges (TicketStatusBadge, TicketPriorityBadge) usan switch largu√≠simos con JSX repetido.

Esto es perfecto para un map de configuraci√≥n:
STATUS_CONFIG[status] = { label, color, icon }
y un componente que lee de ah√≠.

Ventaja: a√±adir estados nuevos no implica otro case gigante.

Filtros multi-tenant en TicketList:
Hay bastante l√≥gica repetida para:
- cargar tenants
- cargar usuarios
- mapear a <option>
Esto encaja bien con:
- hook useTenantFilterOptions / useUserFilterOptions
- y un peque√±o componente <FilterSelect ... />.

Uso de fechas (new Date(...).toLocaleDateString, format, formatDistanceToNow) aparece disperso en varias vistas.

Buen candidato a utilitaria √∫nica (formatDate, formatDateTime, formatRelative) para:
- consistencia de formato
- un √∫nico sitio para regionalizaci√≥n.

4. Zonas con ‚Äúc√≥digo de herramienta‚Äù / scripts
Los scripts de seeds (seed-users, seed-taxonomies, seed-workflows, synthetic-tenants, mfa-logic, listModels, etc.) est√°n bastante bien, pero:

Hay duplicaci√≥n de l√≥gica de conexi√≥n a Mongo (new MongoClient(uri) + dotenv.config + MONGODBURI not found) en varios ficheros.

Aqu√≠ encaja:
- Un helper com√∫n (getSeedClientOrExit()), compartido por todos los scripts.

Tambi√©n hay fragmentos de logging muy parecidos (console.log Seed Iniciando..., console.error Error en seed), f√°cilmente unificables en un peque√±o helper.

Algunos scripts tienen comentarios tipo:
‚ÄúComo no podemos verificar f√°cilmente la DB principal desde este script‚Ä¶‚Äù

Claramente hay cierta deuda t√©cnica ah√≠. Se podr√≠a:
- centralizar los helpers de conexi√≥n (connectDB / connectAuthDB) tambi√©n para scripts.

5. Dead-ish code / flags no usados del todo
En la p√°gina de t√©cnico (PedidosPage) se ve un formData.appendingestOnly, true // New flag for fast ingest.

Habr√≠a que revisar si ese flag:
- est√° soportado realmente en el endpoint backend,
- o si es algo que se empez√≥ y se qued√≥ a medias.

Si no se usa en el servidor, es ruido y conviene o:
- completarlo (feature), o
- eliminarlo.

En NotificationService hay paths de c√≥digo bastante complejos para:
- recipients globales
- userPrefs
- extraRecipients

Podr√≠a haber ramas que casi nunca se ejecuten (por dise√±o actual de producto) y que convendr√≠a:
- o bien simplificar (si la funcionalidad ya no se usa),
- o bien documentar mejor y testear.

6. Coherencia con lo que ya definimos en los docs
Lo bueno: casi todo esto encaja perfecto con los docs que te gener√©:

En mejoras-tecnicas.md y scripts-implementacion.md ya plante√°bamos:
~~- estandarizaci√≥n de API responses~~
~~- hooks reutilizables~~
~~- componentes comunes~~
~~- extracci√≥n de l√≥gica repetida.~~

En roadmap-detallado.md y matriz-priorizacion.md:
la parte de refactor front/UX en Weeks 6-7 es justo el sitio para atacar:
- recarga con window.location.reload()
~~- tablas repetidas~~
~~- hooks duplicados.~~


üéØ MINI-REFCTOR TICKETING (2 d√≠as de trabajo) - **PENDIENTE**
PROBLEMA IDENTIFICADO
Ticketing tiene 3 m√≥dulos con c√≥digo 80% duplicado:
- TicketList (fetch + filtros)
- TicketDetail (reply + escalar + nota interna)
- TicketActions (badges + utils)

L√≠neas afectadas: ~800 l√≠neas ‚Üí ~400 l√≠neas post-refactor

~~üì¶ PASO 1: HOOKS GEN√âRICOS (Day 1, 3h)~~
~~Crear hooks/useApiList.ts y useApiMutation.ts:~~ (COMPLETADO)

~~üì¶ PASO 2: COMPONENTE TABLA GEN√âRICO (Day 1, 2h)~~
~~(COMPLETADO como DataTable.tsx)~~

üì¶ PASO 3: APLICAR A TICKETLIST (Day 1, 1h) - **PR√ìXIMO PASO**

üì¶ PASO 4: APLICAR A TICKETDETAIL (Day 2, 2h) - **PR√ìXIMO PASO**

üì¶ PASO 5: BENEFICIOS MEDIBLES - **EN PROGRESO**


üöÄ PLAN DE EJECUCI√ìN (2 D√çAS)
~~D√≠a 1 (4h):~~
~~- 9am-12pm: Crear hooks gen√©ricos + tests~~
~~- 1pm-3pm: DataTable component + tests~~
~~- 3pm-4pm: Refactor TicketList (primera victoria)~~ (Refactorizada Documentos/Usuarios en su lugar)

D√≠a 2 (4h):
- 9am-11am: Refactor TicketDetail (acciones)
~~- 11am-1pm: Usuarios page (segunda victoria)~~ (COMPLETADO)
~~- 1pm-3pm: TiposDocumento page (tercera victoria)~~ (COMPLETADO)
- 3pm-4pm: Tests + cleanup


MAPA COMPLETO DEL PROYECTO - HOOKS REUTILIZABLES
ABD RAG Platform - Estructura de Hooks + Componentes Gen√©ricos

~~üéØ HOOKS GEN√âRICOS (CORE - 8 hooks)~~
~~1. useApiList - Listas paginadas con filtros~~ (COMPLETADO)
~~2. useApiMutation - CRUD con confirm + toast~~ (COMPLETADO)
~~3. useFormModal - Modal gen√©rico create/edit~~ (COMPLETADO)
~~4. useDeleteConfirm~~ (Integrado en useApiMutation)
~~5. useOptimisticUpdate - UX instant√°nea~~ (COMPLETADO como useApiOptimistic)
~~6. useFilters - Filtros persistentes (localStorage)~~ (COMPLETADO como useFilterState / useLocalStorage)
~~7. useEntityActions~~ (Se maneja via columnas en DataTable)
~~8. useApiFileUpload - Upload con progreso~~ (COMPLETADO)

üìä HOOKS DOMINIO-ESPEC√çFICOS (12 hooks)
Ticketing (4 hooks) - **PENDIENTE**
- useTickets()
- useTicketActions()
- useTicketHistory()
- useTicketMetrics()

Admin (4 hooks)
~~- useAdminUsers()~~ (Implementado via useApiList gen√©rico)
~~- useAdminTypes()~~ (Implementado via useApiList gen√©rico)
~~- useAdminTenants()~~ (Implementado via useApiList gen√©rico)
- useAdminWorkflows()

T√©cnico (4 hooks)
- useRagAnalysis()
~~- useVectorResults()~~ (Implementada en KnowledgeExplorer)
- useAgentTrace()
~~- useDocumentUpload()~~ (Implementado como useApiFileUpload)

üèóÔ∏è COMPONENTES GEN√âRICOS (6 componentes)
~~1. DataTable - Tabla CRUD completa~~ (COMPLETADO)
2. FilterBar - Barra de filtros reutilizable
3. EntityModal - Modal create/edit gen√©rico
4. StatusBadge - Badges configurables
5. ActionBar - Barra de acciones
6. Timeline - Historial mensajes

üó∫Ô∏è MAPA COMPLETO POR P√ÅGINA
P√°gina Actual | L√≠neas | Post-refactor | Hooks Usados | Componentes
--- | --- | --- | --- | ---
TicketList | 250 | 40 | useApiList, useFilters | DataTable, FilterBar
TicketDetail | 300 | 80 | useApiMutation, useTicketActions | Timeline, ActionBar, StatusBadge
~~AdminUsuarios~~ | ~~220~~ | ~~50~~ | ~~useApiList~~ | ~~DataTable~~ (COMPLETADO)
~~AdminTipos~~ | ~~180~~ | ~~40~~ | ~~useApiList, useApiMutation~~ | ~~DataTable~~ (COMPLETADO)
PedidosPage | 160 | 50 | useDocumentUpload, useRagAnalysis | VectorResultsTable, AgentTrace
AdminWorkflows | 140 | 40 | useApiList | DataTable
~~AdminTenants~~ | ~~120~~ | ~~30~~ | ~~useApiList~~ | ~~DataTable~~ (COMPLETADO)
~~KnowledgeExplorer~~ | ~~300~~ | ~~100~~ | ~~useApiList, useApiExport~~ | ~~DataTable~~ (COMPLETADO)

~~üöÄ PLAN DE IMPLEMENTACI√ìN (1 SEMANA)~~ - **EN EJECUCI√ìN**
D√≠a 1-2: Core Hooks (8h) - **COMPLETADO**
D√≠a 3: Componentes Base (6h) - **EN PROGRESO (DataTable listo)**
D√≠a 4-5: Refactor Ticketing / Admin (12h) - **Admin completado, Ticketing pendiente**
