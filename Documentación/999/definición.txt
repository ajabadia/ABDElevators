Es una plataforma SaaS de RAG industrial/empresarial para an√°lisis t√©cnico de documentaci√≥n, con foco fuerte en cumplimiento, observabilidad y multi‚Äëtenant.
‚Äã

Para qu√© sirve (visi√≥n funcional)
Asistente t√©cnico sobre documentos: carga e indexa PDFs t√©cnicos (manuales, planos, normativa, esquemas el√©ctricos) y permite hacer preguntas en lenguaje natural (RAG) con Gemini/LLM, recuperando ‚Äúchunks‚Äù de contexto y mostrando las fuentes consultadas.
‚Äã

Gesti√≥n de conocimiento multi‚Äëtenant y ‚Äúspaces‚Äù: organiza el conocimiento en ‚Äútenants‚Äù y ‚Äúspaces‚Äù aislados (global, industry, tenant, team, personal), con control de acceso por espacio y ‚ÄúScoped API Keys‚Äù para integraciones externas (IoT, CRM, etc.).
‚Äã

Gobernanza y compliance: m√≥dulo de Audit Trail, Logs, Compliance, permisos RBAC/ABAC, GDPR export/delete, certificaciones de borrado, WCAG 2.1 AA, MFA, rotaci√≥n de secretos internos y allow‚Äëlisting por IP.
‚Äã

Evaluaci√≥n de calidad RAG: dashboard de ‚ÄúRAG quality‚Äù con m√©tricas de faithfulness, relevance, context precision y un ‚ÄúLLM Judge‚Äù que eval√∫a cada respuesta, m√°s causal analysis para diagnosticar por qu√© falla una respuesta.
‚Äã

Workflows y orquestaci√≥n: editor visual de workflows (SwitchCase, Wait, Loop), ejecuci√≥n en tiempo real con Mission Control, tareas humanas para gobernanza y escalados, integraci√≥n con un ‚ÄúCausal Auto‚ÄëCorrection IA‚Äù y ‚ÄúCausal Simulation Engine‚Äù orientado a Digital Twins/What‚ÄëIf.
‚Äã

Ingesta robusta de documentos: pipeline as√≠ncrono con BullMQ, auto‚Äëreintentos, detecci√≥n de stuck jobs, deduplicaci√≥n por MD5, extracci√≥n dual OCR+IA, y reporting t√©cnico de errores de ingest (ej. fallos Cloudinary 401).
‚Äã

M√≥dulo de billing y l√≠mites de consumo: gesti√≥n de planes, cuotas (tokens, almacenamiento, reports), l√≠mites de tasa (rate limiting) por IP, circuito de resiliencia ante fallos de pasarelas de pago, y ‚ÄúBilling Hub‚Äù.
‚Äã

Playground y laboratorio de prompts: ‚ÄúAI Playground / RAG Experiment Lab‚Äù donde se pueden variar modelo, temperatura, chunkSize, topK, instrucci√≥n base, y ver chunks, m√©tricas y trazas de evaluaci√≥n.
‚Äã

Auditor√≠a de arquitectura y seguridad (alto nivel)
Stack y arquitectura

Next.js App Router con layouts autenticados, middleware de seguridad, instrumentaci√≥n server‚Äëside y dynamic imports para dashboards pesados.
‚Äã

MongoDB multi‚Äëbase (AUTH, LOGS, MAIN / ABDElevators, etc.), Neo4j para Graph‚ÄëEnhanced RAG, Cloudinary para assets, BullMQ para workers de ingest.
‚Äã

Separaci√≥n de core de workflows vs. case management (‚ÄúCore Engine Separation‚Äù) y m√≥dulos verticales (Legal, Banking, Insurance, Industrial‚Ä¶).
‚Äã

Autenticaci√≥n y autorizaci√≥n

NextAuth con Magic Link, MFA opcional (TOTP) y centro de seguridad, control de roles (USER, ADMIN, SUPERADMIN) y ‚ÄúrequireRole‚Äù en grupos de rutas admin.
‚Äã

Middleware que: aplica rate limiting por IP, fuerza login en todo lo no p√∫blico, bloquea acceso a rutas internas con secreto rotatorio y allow‚Äëlist de IPs, y exige MFA fuera de unas pocas rutas permitidas.
‚Äã

Seguridad de API y multi‚Äëtenant

getTenantCollection y servicios de espacio para garantizar aislamiento de datos por tenant/space; hay correcci√≥n expl√≠cita de un bug hist√≥rico de aislamiento al crear API keys con spaceId.
‚Äã

API Keys con permisos escopados, estado ACTIVE/REVOKED, tracking de lastUsedAt, auditor√≠a exhaustiva en logEvento y revalidaci√≥n de paths admin tras cambios.
‚Äã

Observabilidad y logging

Sistema de eventos estructurados con source, action, correlationId, tenantId, durationMs, niveles DEBUG/INFO/WARN/ERROR y paneles de ‚ÄúObservabilidad / Alerting‚Äù.
‚Äã

Alertas por SLO/SLA (ej. ‚ÄúAsset list slow 1778ms‚Äù, ‚ÄúLISTASSETSSLOW‚Äù) y reporting de errores en workers (Cloudinary, AI, etc.).
‚Äã

Hardening del front y middleware

Polyfill de DOMMatrix en instrumentation para pdf‚Äëparse bajo Node 20 en Vercel.
‚Äã

CSP muy restrictivo con nonces, HSTS condicional, X‚ÄëFrame‚ÄëOptions DENY, X‚ÄëContent‚ÄëType‚ÄëOptions, Referrer‚ÄëPolicy, Permissions‚ÄëPolicy, etc.
‚Äã

Estrategia ‚Äúfail closed‚Äù en middleware: ante error devuelve 500 JSON en vez de dejar pasar la petici√≥n.
‚Äã

M√≥dulos principales detectados
M√≥dulo	Funci√≥n principal
Search / Smart Search	B√∫squeda conversacional sobre toda la documentaci√≥n t√©cnica. 
‚Äã
Document Library / Assets	Gesti√≥n, ingesta y deduplicaci√≥n de PDFs y otros formatos. 
‚Äã
Knowledge Hub / Spaces	Organizaci√≥n del conocimiento por espacios aislados. 
‚Äã
AI Hub	Acceso a RAG quality, workflows, predictive, playground, prompts. 
‚Äã
Quality / RAG Eval	M√©tricas de calidad de respuestas y panel de fiabilidad. 
‚Äã
Compliance / Audit	Trazabilidad, exportaci√≥n, GDPR, logs de sistema. 
‚Äã
Billing Hub	Planes, consumo, l√≠mites de tokens, almacenamiento. 
‚Äã
Security Hub	MFA, sesiones, API keys, configuraci√≥n de seguridad. 
‚Äã
Operations Hub	Monitorizaci√≥n de ingest, colas, errores, SLAs. 
‚Äã
Comentarios de auditor√≠a (oportunidades/mejoras)
Workers en Vercel: el propio c√≥digo advierte sobre evitar workers persistentes en serverless; conviene asegurar despliegue dedicado (Queue/Worker host) para BullMQ si la carga crece.
‚Äã

Gesti√≥n de errores de terceros: Cloudinary devuelve 401 en ingest; ser√≠a aconsejable circuit breaker y paths de degradaci√≥n m√°s suaves para no bloquear toda la cola.
‚Äã

Consistencia multi‚ÄëDB: hay scripts de inspecci√≥n de clusters y DB consistency auditor; mantenerlos operativos en CI/cron ayudar√≠a a detectar fugas cross‚Äëtenant o colecciones hu√©rfanas.
‚Äã

UX de seguridad: el sistema ya es muy estricto (MFA, rate limit, fail closed); revisar mensajes de error para no filtrar demasiado detalle t√©cnico en entornos p√∫blicos.
‚Äã

Se trata de una plataforma empresarial completa llamada "ABD RAG Platform" - un sistema de Retrieval-Augmented Generation (RAG) para an√°lisis t√©cnico industrial.
üéØ Prop√≥sito General
Esta es una plataforma de inteligencia artificial empresarial que permite a organizaciones industriales (especialmente del sector de ascensores/elevadores, pero adaptable a otros verticales) procesar documentaci√≥n t√©cnica, realizar an√°lisis de cumplimiento normativo y generar informes inteligentes mediante RAG (Retrieval-Augmented Generation).
üèóÔ∏è Arquitectura del Sistema
1. Estructura de Seguridad Multi-Capa
Table
Copy
Capa	Implementaci√≥n	Descripci√≥n
Middleware (middleware.ts)	NextAuth + Rate Limiting	Autenticaci√≥n JWT, MFA, CSP, HSTS, rate limiting por IP
Autorizaci√≥n	RBAC + ABAC	Roles (SUPER_ADMIN, ADMIN, USER) + permisos granulares
Tenant Isolation	MongoDB multi-tenant	Separaci√≥n estricta de datos por organizaci√≥n
API Keys	Scoped + Rotatable	Claves de API con permisos espec√≠ficos y rotaci√≥n de secretos
Caracter√≠sticas de seguridad notables:
MFA obligatorio para administradores (ENFORCE_MFA_ADMIN)
Rate limiting diferenciado (auth vs core endpoints)
Secret rotation para APIs internas (INTERNAL_API_SECRET + PREVIOUS_INTERNAL_API_SECRET)
CSP din√°mico con nonces (diferente para dev/prod)
Fail-closed en errores de middleware
2. Sistema de Ingesta y Procesamiento de Documentos
TypeScript
Copy
// Flujo de procesamiento:
PDF/Documento ‚Üí Cloudinary (almacenamiento) 
    ‚Üí Ingest Worker (Bull Queue) 
    ‚Üí Chunking + Vectorizaci√≥n (Gemini Embeddings)
    ‚Üí MongoDB (metadatos) + Vector DB (b√∫squeda sem√°ntica)
Componentes clave:
Ingest Worker: Procesamiento as√≠ncrono con colas (Bull/Redis)
Dead Letter Queue (DLQ): Reintentos autom√°ticos para jobs fallidos
Deduplicaci√≥n: Hash MD5 para evitar documentos duplicados
OCR integrado: Procesamiento de PDFs escaneados
3. Motor RAG (Retrieval-Augmented Generation)
Flujo de consulta:
Query Understanding: An√°lisis sem√°ntico de la pregunta
Vector Search: B√∫squeda en embeddings (top-k chunks relevantes)
Context Assembly: Construcci√≥n de contexto con chunks + metadatos
LLM Generation: Gemini 2.0 Flash/Pro con prompting especializado
Evaluation: M√©tricas de calidad (faithfulness, relevance, precision)
Caracter√≠sticas avanzadas:
Multi-tenancy en vector store (filtros por tenantId)
Context limits configurables por "Knowledge Spaces"
Re-ranking basado en relevancia
Citation tracking (trazabilidad de fuentes)
4. Sistema Multi-Vertical (Entity Engine)
El c√≥digo muestra un motor de entidades gen√©rico (EntityEngine) que permite adaptar la plataforma a diferentes industrias:
TypeScript
Copy
// Ejemplo: Entidad "pedido" (√≥rdenes de trabajo)
const entity = EntityEngine.getInstance().getEntity('pedido');
// API endpoints, formularios, tablas generados din√°micamente
Verticales soportados:
ELEVATORS: Ascensores y equipos de elevaci√≥n
LEGAL: Documentaci√≥n legal/jur√≠dica
MEDICAL: Documentaci√≥n sanitaria
BANKING/INSURANCE: Financiero
GENERIC: Prop√≥sito general
5. Sistema de Workflows Ag√©nticos
Workflow Designer: Editor visual de flujos (React Flow)
Autonomous Agents: Agentes que ejecutan tareas complejas
Validation Workflows: Flujos de validaci√≥n humana (HITL - Human In The Loop)
Task Inbox: Bandeja de entrada para tareas pendientes
üìä M√≥dulos Funcionales Detallados
Administraci√≥n (Admin Panel)
Table
Copy
M√≥dulo	Funci√≥n	Fase/Tecnolog√≠a
AI Hub	Playground RAG, evaluaci√≥n de calidad, workflows	Phase 133
Knowledge Hub	Gesti√≥n de espacios de conocimiento, documentos, explorer vectorial	Phase 105
Organizations	Configuraci√≥n multi-tenant, branding, facturaci√≥n, storage	Phase 110
Permissions (Guardian)	Matriz de permisos RBAC/ABAC, simulador, auditor√≠a	Phase 120+
Operations	Observabilidad, logs t√©cnicos, tracing, mantenimiento	Phase 31
Intelligence	Federated learning, patrones globales, an√°lisis predictivo	Phase 160
Compliance	GDPR, EU AI Act, data portability, right to be forgotten	Phase 183
Notifications	Gesti√≥n de templates, canales, programaci√≥n	Phase 140
Billing	Usage tracking, ROI calculator, facturaci√≥n	Phase 24.2
Prompts	Governance de prompts, versionado, multi-idioma	Phase 7.6
i18n	Gesti√≥n de traducciones, sincronizaci√≥n JSON‚ÜîBD	Phase 62
SuperAdmin	Dashboard global multi-tenant, m√©tricas de plataforma	Phase 110
Panel T√©cnico (Technical Users)
Entities: An√°lisis de documentos t√©cnicos con IA
Graphs: Visualizaci√≥n de grafos de conocimiento (Neo4j)
Validation: Workflows de validaci√≥n con trazabilidad
üîß Stack Tecnol√≥gico
Frontend
Framework: Next.js 14+ (App Router, Server Components)
UI: Tailwind CSS + shadcn/ui (design system consistente)
Estado: Zustand (stores modulares), React Query (server state)
Visualizaci√≥n: React Flow (workflows), D3/Cytoscape (grafos)
Internacionalizaci√≥n: next-intl (es/en principalmente)
Backend
Runtime: Node.js (Vercel Serverless + Edge)
Base de datos:
MongoDB Atlas (datos estructurados, tenant-sharded)
Redis (cach√©, rate limiting, colas Bull)
Neo4j (grafos de conocimiento)
Vector Store: Pinecone/Weaviate (impl√≠cito por vectorSearches)
Colas: Bull (Redis) para procesamiento as√≠ncrono
Storage: Cloudinary (documentos), Vercel Blob (assets)
IA/ML
LLM: Google Gemini 2.0 (Flash/Pro/Ultra)
Embeddings: text-embedding-004
Framework: LangChain/LangGraph (impl√≠cito en "Agent Engine")
Evaluaci√≥n: RAGAS-like metrics (faithfulness, relevance, precision)
Observabilidad
Tracing: OpenTelemetry (Jaeger/Zipkin)
Logging: Sistema propio con correlaci√≥n ID
M√©tricas: Dashboard interno de usage, ROI, anomal√≠as
üöÄ Caracter√≠sticas Empresariales Destacadas
1. Arquitectura Multi-Tenant Avanzada
TypeScript
Copy
// Ejemplo de aislamiento en c√≥digo:
const keysCollection = await getTenantCollection<ApiKey>('api_keys', session);
// Cada query autom√°ticamente filtra por tenantId del JWT
2. Federated Intelligence
Aprendizaje de patrones entre tenants (an√≥nimo/aggregrado)
Ontolog√≠a evolutiva que se refina con feedback humano
"Sovereign Engine" para refinamiento aut√≥nomo de taxonom√≠as
3. Sistema de Reportes Inteligente
Templates din√°micos (inspecci√≥n, auditor√≠a, calidad RAG)
Programaci√≥n con cron (diario/semanal/mensual)
Exportaci√≥n PDF con branding personalizado
4. Cumplimiento Normativo (Compliance)
GDPR: Portabilidad de datos, derecho al olvido
EU AI Act: Registro de modelos, clasificaci√≥n de riesgo
SOC 2: Auditor√≠a inmutable de cambios de configuraci√≥n
ISO 27001: Gesti√≥n de activos, ciclo de vida documental
5. Sistema de "Knowledge Spaces"
Permite crear "espacios de conocimiento" aislados con:
L√≠mites de contexto configurables
Permisos granulares (qui√©n puede consultar qu√©)
Versionado de documentos
üé® Patrones de Dise√±o Implementados
Table
Copy
Patr√≥n	Uso
Repository Pattern	getTenantCollection<T>() - abstracci√≥n de BD
CQRS	Separaci√≥n de comandos (mutations) y queries (hooks)
Factory Pattern	EntityEngine para generar componentes din√°micos
Strategy Pattern	Diferentes estrategias de chunking/embedding
Observer Pattern	Sistema de eventos para notificaciones
Circuit Breaker	Manejo de fallos en APIs externas (rate limiting)
üìà Escalabilidad y Performance
Edge Functions: Middleware en Vercel Edge para baja latencia
Streaming: Respuestas LLM en streaming (impl√≠cito en componentes)
Lazy Loading: Componentes pesados cargados din√°micamente (next/dynamic)
Optimistic UI: Actualizaciones inmediatas en frontend
CDN: Cloudinary para assets, Vercel para static
üîç Conclusi√≥n
Esta es una plataforma RAG enterprise-grade dise√±ada para organizaciones industriales que necesitan:
Procesar grandes vol√∫menes de documentaci√≥n t√©cnica
Consultar informaci√≥n mediante lenguaje natural con precisi√≥n
Cumplir con regulaciones estrictas (GDPR, EU AI Act, ISO)
Operar en m√∫ltiples verticales con configuraci√≥n flexible
Escalar multi-tenant con aislamiento de datos garantizado
El c√≥digo muestra una madurez arquitect√≥nica considerable (fases 31-183 documentadas), con √©nfasis en seguridad, observabilidad y gobernanza de IA - caracter√≠sticas esenciales para despliegues empresariales cr√≠ticos.




