PASS tests/unit/workflow-service.test.ts
PASS tests/unit/usage-service.test.ts
PASS tests/unit/checklist-extractor.test.ts
PASS tests/unit/mfa-service.test.ts
PASS tests/unit/usage-service-coverage.test.ts
  ‚óè Console

    console.error
      [UsageService] Error calculating User Metrics: Error: DB Connection Failed
          at Object.<anonymous> (D:\desarrollos\ABDElevators\tests\unit\usage-service-coverage.test.ts:47:50)
          at Promise.finally.completed (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
          at D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
          at run (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (D:\desarrollos\ABDElevators\node_modules\jest-circus\build\runner.js:101:19)
          at runTestInternal (D:\desarrollos\ABDElevators\node_modules\jest-runner\build\testWorker.js:275:16)
          at runTest (D:\desarrollos\ABDElevators\node_modules\jest-runner\build\testWorker.js:343:7)
          at Object.worker (D:\desarrollos\ABDElevators\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 264 |[39m
     [90m 265 |[39m         } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 266 |[39m             console[33m.[39merror([32m'[UsageService] Error calculating User Metrics:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 267 |[39m             [36mreturn[39m { validationsCount[33m:[39m [35m0[39m[33m,[39m ticketsCreated[33m:[39m [35m0[39m[33m,[39m ticketsResolved[33m:[39m [35m0[39m[33m,[39m efficiencyScore[33m:[39m [35m0[39m }[33m;[39m
     [90m 268 |[39m         }
     [90m 269 |[39m     }[0m

      at Function.error [as getUserMetrics] (src/lib/usage-service.ts:266:21)
      at Object.<anonymous> (tests/unit/usage-service-coverage.test.ts:49:28)

PASS tests/unit/pdf-export.test.ts
  ‚óè Console

    console.log
      PDF generado en 56ms

      at log (src/lib/pdf-export.ts:135:17)

PASS tests/unit/prompt-service.test.ts
  ‚óè Console

    console.error
      [DEBUG PROMPT] NOT FOUND: { key: "UNKNOWN", tenantId: "tenant_123", active: true }

    [0m [90m 18 |[39m
     [90m 19 |[39m         [36mif[39m ([33m![39mprompt) {
    [31m[1m>[22m[39m[90m 20 |[39m             console[33m.[39merror([32m`[DEBUG PROMPT] NOT FOUND: { key: "${key}", tenantId: "${tenantId}", active: true }`[39m)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 21 |[39m             [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NOT_FOUND'[39m[33m,[39m [35m404[39m[33m,[39m [32m`Prompt con key "${key}" no encontrado para este tenant (${tenantId})`[39m)[33m;[39m
     [90m 22 |[39m         }
     [90m 23 |[39m[0m

      at Function.error [as getPrompt] (src/lib/prompt-service.ts:20:21)
      at Object.<anonymous> (tests/unit/prompt-service.test.ts:67:13)

    console.log
      [DEBUG PROMPT] Key: "TEST_PROMPT", Model: "gemini-3-flash-preview"

      at Function.log [as getRenderedPrompt] (src/lib/prompt-service.ts:73:17)

PASS tests/unit/prompt-service-coverage.test.ts
------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------
File                    | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                             
------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------
All files               |   76.21 |    52.51 |   42.22 |   76.26 |                                                                                                                               
 checklist-extractor.ts |   79.31 |       25 |     100 |   78.57 | 47,70,101-113                                                                                                                 
 errors.ts              |   53.84 |        0 |   14.28 |   53.84 | 31,46,52,58,64,72-95                                                                                                          
 logger.ts              |   14.28 |        0 |       0 |   14.28 | 26-47                                                                                                                         
 mfa-service.ts         |    82.6 |     87.5 |      75 |   80.95 | 112,138-161                                                                                                                   
 pdf-export.ts          |   85.54 |     62.5 |      75 |   85.36 | 72-73,97-98,139-140,148-153                                                                                                   
 prompt-service.ts      |   79.59 |    56.92 |   66.66 |   81.81 | 69,89-90,113,192,248-249,272-287                                                                                              
 schemas.ts             |   67.64 |       50 |   11.11 |   68.31 | 37,57,73,100-101,114,172-173,192-204,224,257,279,316,327,504,664-665,730,805,827,849,886-887,897-898,931-932,953,979-980,1007 
 usage-service.ts       |    86.2 |    73.07 |   69.23 |   85.45 | 42-84,134-135,217-219                                                                                                         
 workflow-service.ts    |   89.47 |    33.33 |      75 |   89.47 | 54-55                                                                                                                         
------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------

Test Suites: 8 passed, 8 total
Tests:       26 passed, 26 total
Snapshots:   0 total
Time:        4.04 s, estimated 7 s
Ran all test suites matching tests/unit/.
