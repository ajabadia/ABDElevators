
no, hazme una definiciÃ³n funcional de la ampliaciÃ³n para pasÃ¡rsela a la IA que lo tiene que programar, con todas las instrucciones y detalles necesarios
DEFINICIÃ“N FUNCIONAL COMPLETA
AmpliaciÃ³n RAG + Checklists DinÃ¡micos Configurables
Copia este documento COMPLETOÂ a Cursor/AntigrÃ¡vity para generar el cÃ³digo.

ğŸ¯ CONTEXTO DEL PROYECTO
Proyecto:Â Sistema RAG anÃ¡lisis pedidos ascensores (Next.js + MongoDB + Gemini)
Stack actual:Â Next.js 15, MongoDB Atlas, Gemini API, Vercel
Estado:Â MVP bÃ¡sico funcional (upload â†’ analyze â†’ informe simple)
Objetivo:Â EvoluciÃ³n a sistema RAG completo + checklists dinÃ¡micos configurables
IMPORTANTE:Â SeguirÂ TODASÂ las reglas deÂ instrucciones-cursor-antigrÃ¡vity.mdÂ (TypeScript strict, Zod, AppError, logging, etc).

ğŸ—ï¸ ARQUITECTURA FINAL REQUERIDA
text
PEDIDO PDF
    â†“
1. VECTOR SEARCH (MongoDB Atlas Vector Search)
    â†“ [0.2s]
2. RESULTADOS RAW (Top 15 docs oficiales + scores)
    â†“
3. CHECKLIST DINÃMICA (extraÃ­da de Top 5 docs)
    â†“
4. VALIDACIÃ“N HUMANA (categorÃ­as configurables)
    â†“
5. AUDIT TRAIL + FIRMA DIGITAL
    â†“ [OPCIONAL]
6. LLM INFORME FORMAL (solo si solicitado)

ğŸ“‹ REQUISITOS FUNCIONALES
1. Corpus Docs Oficiales (Pre-cargado)
text
Estructura cada PDF oficial:
{
  _id: ObjectId,
  tipo: 'oficial',
  titulo: "BTN-1234 Manual InstalaciÃ³n",
  texto_completo: "...",
  chunks: [{texto: "...", embedding: [0.23,...]}],
  metadata: {
    url_original: "docs/btn1234.pdf",
    version: "v1.2",
    fabricante: "Schindler"
  }
}
Tarea:Â Script para indexar 50+ PDFs oficiales.
2. Vector Search Endpoint
text
GET /api/pedidos/[id]/vector-search
Input: pedido_id
Output:
{
  success: true,
  docs: [{
    id, titulo, snippet, score, url, metadata
  }],
  stats: { total, avg_score }
}
Sin LLM. Solo matemÃ¡ticas vectoriales.
3. Configurador Checklists (Admin)
text
POST /api/admin/configs-checklist â†’ Crear config
GET  /api/admin/configs-checklist â†’ Listar configs
PUT  /api/admin/configs-checklist/[id] â†’ Update config
Config schema:
typescript
interface ChecklistConfig {
  nombre: string  // "Residencial", "Hospital"
  categorias: Array<{
    id: string
    nombre: string
    color: string  // "#ef4444"
    keywords: string[]
    prioridad: number
  }>
  workflow_orden: string[]  // ['seguridad', 'electrico']
}
4. Checklist DinÃ¡mica Endpoint
text
GET /api/pedidos/[id]/checklist?config_id=xxx
1. Vector search Top 15 docs
2. Extraer checklists Top 5 docs (LLM mini-prompt)
3. Auto-clasificar por keywords config
4. Ordenar: prioridad config â†’ score doc
Output:
{
  items: [{
    id, texto, categoria_id, score_doc, auto_clasificado: true
  }]
}
5. ValidaciÃ³n Empleado
text
POST /api/pedidos/[id]/validate
Input: { validated_docs: [], missing_docs: [], notas: {} }
Audit trail:
{
  pedido_id, empleado_id, validated_docs, missing_docs, completa, timestamp
}

ğŸ–¥ï¸ UI/UX REQUERIDA
Pantalla Empleado (ValidaciÃ³n)
text
VECTOR RESULTS (Top 15)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 94% BTN-1234 Manual [Ver PDF]â”‚
â”‚ 91% MTR-5678 Specs [Ver PDF] â”‚
â”‚ 88% Normativa CE [Ver PDF]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CHECKLIST DINÃMICA (Ordenada)
ğŸ”´ 1. Seguridad (3 Ã­tems)
  â˜ CE certificado obligatorio
  â˜ Pruebas funcionales OK
â˜‘ï¸ 2. Normativa (1 Ã­tem)
  â˜‘ï¸ UE 2014/33 cumplida
ğŸ”µ 3. ElÃ©ctrico (2 Ã­tems)
  â˜ Voltaje 380V verificado

âœ… VALIDACIÃ“N COMPLETA [Firmar Digital]
[Generar Informe LLM] â† Opcional
Pantalla Admin (Configurador)
text
CONFIGURACIONES
â”œâ”€â”€ Residencial â† Editando
â”œâ”€â”€ Hospitalaria
â””â”€â”€ Industrial

EDITOR CONFIG "Residencial":
Nombre: Residencial

CATEGORÃAS (Drag-drop orden):
ğŸ”´ Seguridad [â†‘â†“] keywords: ce,seguridad
ğŸŸ¡ Normativa [â†‘â†“] keywords: ue,normativa  
ğŸ”µ ElÃ©ctrico [â†‘â†“] keywords: voltaje,cable

ÃTEMS DETECTADOS (Drag-drop categorÃ­a):
"CE cert" â†’ ğŸ”´ Seguridad âœ“
"Voltaje 380V" â†’ ğŸ”µ ElÃ©ctrico âœ“  â† Arrastrar si error

â• AÃ±adir manual  ğŸ’¾ Guardar Config

ğŸ”§ ESPECIFICACIONES TÃ‰CNICAS
MongoDB Collections Nuevas
text
configs_checklist:
- ChecklistConfig schema arriba

validaciones_empleados:
{
  pedido_id, empleado_id, config_id,
  validated_docs: [], missing_docs: [],
  checklist_items: [{id, estado, notas}],
  completa: boolean, timestamp
}

documentos_oficiales:
- PDFs pre-procesados + embeddings
Endpoints Completos
text
1. GET /api/pedidos/[id]/vector-search
2. GET /api/admin/configs-checklist
3. POST /api/admin/configs-checklist
4. PUT /api/admin/configs-checklist/[id]
5. GET /api/pedidos/[id]/checklist?config_id=xxx
6. POST /api/pedidos/[id]/validate
7. POST /api/pedidos/[id]/firma-digital (opcional)
Dependencias Nuevas
text
npm install:
- @dnd-kit/core @dnd-kit/sortable  (drag-drop)
- @langchain/community (Gemini embeddings)
- mongodb (vector search native)

ğŸ¨ COMPONENTES REACT REQUERIDOS
text
1. VectorResultsTable.tsx
2. DynamicChecklist.tsx
3. ConfiguratorFull.tsx
4. CategoriaEditor.tsx
5. DraggableItem.tsx (DnD Kit)
6. ValidationWorkflow.tsx
7. AuditTrailViewer.tsx
Props Cada Componente
text
VectorResultsTable:
- docs: VectorResult[]
- onValidateDoc: (docId) => void

DynamicChecklist:
- items: ChecklistItem[]
- config: ChecklistConfig
- onItemUpdate: (id, updates) => void

ConfiguratorFull:
- configs: ChecklistConfig[]
- onSaveConfig: (config) => void

ğŸ§ª TESTS REQUERIDOS
text
1. unit/checklist-extractor.test.ts
2. integration/vector-search.test.ts
3. integration/config-save.test.ts
4. e2e/validation-workflow.spec.ts
5. e2e/configurator.spec.ts
Coverage target:Â 80%+

ğŸ“Š AUDIT TRAIL COMPLETO
text
Cada acciÃ³n registrada:
1. Vector search ejecutado
2. Config usada
3. Ãtems validados/rechazados
4. Tiempo empleado
5. Firma digital
6. Docs faltantes reportados

âš™ï¸ CONFIG DEFAULT (Fallback)
typescript
const DEFAULT_CONFIG = {
  nombre: "General",
  categorias: [
    {
      id: "seguridad",
      nombre: "Seguridad CrÃ­tica",
      color: "#ef4444",
      prioridad: 1,
      keywords: ["ce", "seguridad", "certificado", "riesgo"]
    },
    {
      id: "normativa", 
      nombre: "Normativa",
      color: "#f59e0b",
      prioridad: 2,
      keywords: ["ue", "normativa", "directiva"]
    }
  ]
}

ğŸš€ IMPLEMENTACIÃ“N ORDEN
text
SEMANA 5:
1. DÃA 1: Vector search + DB schema
2. DÃA 2: Checklist extractor + auto-class
3. DÃA 3: Configurador bÃ¡sico (CRUD)
4. DÃA 4: Drag-drop + UI polish
5. DÃA 5: ValidaciÃ³n + audit trail

SEMANA 6:
1. Tests + optimizaciÃ³n
2. Deploy + docs

ğŸ¯ ESPECIFICACIONES FINALES
text
âœ… 100% configurable (0 hardcode)
âœ… N configs â†’ N empresas/tipos
âœ… N categorÃ­as por config
âœ… Keywords editables
âœ… Drag-drop orden
âœ… Auto-clasificaciÃ³n
âœ… Audit completo
âœ… Fallbacks elegantes
âœ… TypeScript strict (todas reglas)
âœ… Tests 80% coverage
âœ… Performance < 1s
âœ… Coste LLM mÃ­nimo ($0.001/pedido)
Generar cÃ³digo completo siguiendo estas especificaciones exactas.
Empezar por:
DB Schema + Vector Search endpoint
Configurador CRUD bÃ¡sico
Checklist extractor LLM
UI completa con DnD
Siguiente entrega:Â CÃ³digo funcional Semana 5. ğŸ¯
